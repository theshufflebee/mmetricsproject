---
title: "Financial Data Analysis"
output:
  pdf_document: 
    toc: true
    fig_caption: yes
    latex_engine: lualatex
header-includes:
  - \usepackage{amsmath}
---
\newpage

```{r library_setup, results=FALSE, warning=FALSE, message=FALSE, echo=FALSE}
rm(list=ls())
require(tinytex) #LaTeX
require(ggplot2) #plots
require(AEC) #JP-Renne functions
require(forecast) #time series stuff
require(expm) #matrix exponents
require(here) #directory finder
require(stringr) # analysis of strings, important for the detection in tweets
require(dplyr) #data management
require(lubridate) #data dates management
require(zoo) #for lagging
require(jtools) #tables
require(huxtable) #tables
require(lmtest) #reg tests
require(vroom) #for loading data

getwd()
#setwd("...") -> set wd at base repo folder

#load helper functions
source(here("helperfunctions/data_loaders.R"))
source(here("helperfunctions/date_selector.R"))
source(here("helperfunctions/plotters.R"))
source(here("helperfunctions/quick_arma.R"))
source(here("helperfunctions/r.vol_calculators.R"))
```
# Data

## Raw Data
```{r rawdata_setup, results=FALSE, warning=FALSE, message=FALSE}

#political shocks
#raw_truths <- read.csv(here("data/political_data", "trump_all_truths.csv"))
#raw_tweets <- read.csv(here("data/political_data", "tweets.csv"))


#market prices
#raw_ONEQ <- read.csv(here("data/market_data", "ONEQ.csv")) #USA
#raw_SMI <- read.csv(here("data/market_data", "SMI.csv")) #CH
#raw_VTHR <- read.csv(here("data/market_data", "VTHR.csv")) #USA
#raw_VTI <- read.csv(here("data/market_data", "VTI.csv")) #USA
#raw_DAX <- read.csv(here("data/market_data", "DAX.csv")) #DE
#raw_ASHR <- read.csv(here("data/market_data", "ASHR.csv")) #CHINA

#S&P500
data_loader(year=2021,months=1:12,"SPY")
data_loader(year=2022,months=1:12,"SPY")
data_loader(year=2023,months=1:12,"SPY")
data_loader(year=2024,months=1:12,"SPY")
data_loader(year=2025,months=1:4,"SPY")
SPY = rbind(raw_SPY_2021,raw_SPY_2022,raw_SPY_2023,raw_SPY_2024,raw_SPY_2025)

#STOXX50
data_loader(year=2020,months=1:12,"VGK")
data_loader(year=2021,months=1:12,"VGK")
data_loader(year=2022,months=1:12,"VGK")
data_loader(year=2023,months=1:12,"VGK")
data_loader(year=2024,months=1:12,"VGK")
data_loader(year=2025,months=1:4,"VGK")
VGK = rbind(raw_VGK_2020,raw_VGK_2021,raw_VGK_2022,
            raw_VGK_2023,raw_VGK_2024,raw_VGK_2025)

#CSI 300 (China)
data_loader_months(year=2025,months=1:2,symbol="ASHR")

```



# Quick Analysis

## SPY April 2nd 2025
```{r helper tutorial, warning=FALSE, message=FALSE}

#extract a particular day
SPY_25_04_02 = day_selector(raw_SPY_2025,2025,04,02) #april 2nd 2025

#let's plot it
price_plotter_day(SPY_25_04_02,"SPY Price on April 2nd 2025") 

#quickly test some ARMA specifications
quick_arma(SPY_25_04_02,1,0,0) #checking AR1,AR2,AR3
#quick_arma(SPY_25_04_02,2,0,0) #checking AR2,AR3,AR4

#extract a particular month
SPY_24_09 = month_selector(raw_SPY_2024,2024,09) #november 2024

```

## Realised Volatility
```{r volatility}
#average per day (outputs scalar)
r.vol_day(SPY_25_04_02) 

#average per day for each day in a month (outputs vector of each day's realised volatility)
r.vol_month(SPY_24_09) 

#avg per day in each month of a year
year_avg = r.vol_year(raw_SPY_2024)
head(year_avg)

#for each hour in a day (outputs a vector of each hour's realised volatility)
r.vol_day_hour(SPY_25_04_02) 

#for each hour in a day for each day in a month (outputs a matrix)
month_hour = r.vol_month_hour(SPY_24_09)
huxtable(head(data.frame(month_hour)))

#for each hour in each day of each month of an entire year
#works for datasets with more than 1 year!
vol_SPY2024 = r.vol_year_hour(raw_SPY_2024,merge=F)
head(vol_SPY2024)
vol_24_09 = month_selector(vol_SPY2024,2024,09)
vol_24_04_02 = day_selector(vol_SPY2024,2024,04,02)

#plots

#hours in a day
plot(r.vol_day_hour(SPY_25_04_02))

#days in a month
plot(r.vol_month(SPY_24_09))

#hours in a year
vol_plotter(vol_SPY2024,breaks="monthly",
                              title="Realised Volatility - SPY 2024")

#hours in a month
vol_plotter(vol_24_09,breaks="daily",
                     title="Realised Volatility - SPY November 2024")

#hours in a day
vol_plotter(vol_24_04_02,breaks="hourly",
              title="Realised Volatility - SPY 2nd of November 2024")




#the following WILL take like 10 minutes to run, you have been warned

#vol_SPY = r.vol_year_hour(SPY,merge=F)
#vol_VGK = r.vol_year_hour(VGK,merge=F)

#vol_plotter(vol_SPY,breaks="monthly",title="SPY Volatility Since 2021")
#vol_plotter(vol_VGK,breaks="monthly",title="VGK Volatility Since 2020")


```











